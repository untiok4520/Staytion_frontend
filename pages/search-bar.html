<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>搜尋欄</title>

    <!-- bs -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.3.2/css/flag-icons.min.css" />

    <!-- CSS Libraries -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />

    <style>
        /* 搜尋列 */

        .search-bar {
            background: #1f487e;
            border-radius: 0.5rem;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1);
            /* 滿版的話也要關掉這個 */
            padding: 1rem;

        }

        /* 自訂 col-md-3.5 */
        @media (min-width: 768px) {
            .col-md-3-5 {
                flex: 0 0 calc(100% * 3.5 / 12);
                max-width: calc(100% * 3.5 / 12);
            }

            .col-md-1-5 {
                flex: 0 0 calc(100% * 1.5 / 12);
                max-width: calc(100% * 1.5 / 12);
            }
        }

        .search-bar input {
            border-radius: 0.25rem;
            border: 1px solid #ccc;
            transition: border-color 0.3s ease;
        }

        .search-bar input:focus {
            border-color: #376996;
            outline: none;
            box-shadow: 0 0 8px rgba(55, 105, 150, 0.4);
        }

        .search-bar button {
            font-weight: 600;
            transition: background-color 0.3s ease;
        }

        .search-bar #search-btn {
            background-color: #1a81ff;
            color: #fff;
        }

        .search-bar #search-btn:hover {
            background-color: #569ff7;
        }

        .input-group-text {
            background-color: #fff;
            border: 1px solid #ccc;
            border-right: none;
        }

        #guest-btn {
            white-space: nowrap;
            cursor: pointer;
        }

        /* popup 視窗 */
        #guest-popup {
            position: absolute;
            left: 48px;
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 0.25rem;
            padding: 1rem;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            width: 85%;
            z-index: 1000;
            display: none;
        }

        #guest-popup .guest-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        #guest-popup .guest-row:last-child {
            margin-bottom: 0;
        }

        #guest-popup .guest-label {
            font-weight: 600;
            color: #333;
        }

        #guest-popup .qty-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        #guest-popup button.qty-btn {
            border: 1px solid #ccc;
            background: #f8f9fa;
            width: 28px;
            height: 28px;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            user-select: none;
        }

        #guest-popup span.count {
            min-width: 20px;
            text-align: center;
            font-weight: 600;
            user-select: none;
            display: inline-block;
        }

        .suggestion-list {
            position: absolute;
            z-index: 1050;
            top: 100%;
            left: 41px;
            width: 89%;
            border: 1px solid #ccc;
            background: #fff;
            border-radius: 0.25rem;
            max-height: 250px;
            overflow-y: auto;
            margin: 0;
            padding: 0;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            list-style: none;
            display: none;

        }

        .suggestion-list li {
            padding: 0.5rem;
            cursor: pointer;

        }

        .suggestion-list li:hover {
            background-color: #f1f1f1;
        }
    </style>
</head>

<body>
    <!-- 搜尋欄 -->
    <section class="container search-bar sticky-top">
        <form class="row g-3 align-items-end" autocomplete="off">

            <!-- 目的地 -->
            <div class="col-12 col-md-3-5">
                <div class="input-group destination-group position-relative ">
                    <span class="input-group-text"><i class="bi bi-geo-alt"></i></span>
                    <input type="text" id="destinationInput" class="form-control" placeholder="請搜尋目的地" />

                    <ul id="suggestions" class="list-group suggestion-list"></ul>
                </div>
            </div>

            <!-- 日期 -->
            <div class="col-12 col-md-3-5">
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-calendar-event"></i></span>
                    <input type="text" id="daterange" class="form-control" placeholder="選擇日期範圍" />
                </div>
            </div>

            <!-- 房客 -->
            <div class="col-8 col-md-3-5 position-relative">
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-people"></i></span>
                    <input type="text" class="form-control" id="guest-btn" readonly />
                </div>

                <!-- popup -->
                <div id="guest-popup" aria-label="房客選擇視窗">
                    <div class="guest-row">
                        <span class="guest-label">成人</span>
                        <div class="qty-control">
                            <button type="button" class="qty-btn" data-action="decrease" data-type="adults">−</button>
                            <span class="count" id="adults-count">2</span>
                            <button type="button" class="qty-btn" data-action="increase" data-type="adults">+</button>
                        </div>
                    </div>
                    <div class="guest-row">
                        <span class="guest-label">孩童</span>
                        <div class="qty-control">
                            <button type="button" class="qty-btn" data-action="decrease" data-type="children">−</button>
                            <span class="count" id="children-count">0</span>
                            <button type="button" class="qty-btn" data-action="increase" data-type="children">+</button>
                        </div>
                    </div>
                    <div class="guest-row">
                        <span class="guest-label">房間</span>
                        <div class="qty-control">
                            <button type="button" class="qty-btn" data-action="decrease" data-type="rooms">−</button>
                            <span class="count" id="rooms-count">1</span>
                            <button type="button" class="qty-btn" data-action="increase" data-type="rooms">+</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 搜尋按鈕 -->
            <div class="col-4 col-md-1-5 d-grid">
                <button type="submit" class="btn" id="search-btn">
                    <i class="bi bi-search pe-2"></i> 搜尋
                </button>
            </div>
        </form>
    </section>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/zh-tw.js"></script>

    <script>
        // 選擇地點 -------------------------------------------------

        const suggestionsEl = document.getElementById("suggestions");
        const destinationInput = document.getElementById("destinationInput");

        const popularCities = ["台北", "台中", "台南", "宜蘭", "花蓮"];

        // 顯示建議清單
        function showSuggestions(keyword = "") {
            const filtered = popularCities.filter(city =>
                city.toLowerCase().includes(keyword.toLowerCase())
            );

            if (filtered.length === 0) {
                suggestionsEl.style.display = "none";
                return;
            }

            suggestionsEl.innerHTML = filtered
                .map(city => `<li class="list-group-item">${city}</li>`)
                .join("");

            suggestionsEl.style.display = "block";
        }

        // 輸入時更新建議
        destinationInput.addEventListener("input", () => {
            const keyword = destinationInput.value.trim();
            showSuggestions(keyword); // 即使 keyword 為空也要顯示熱門城市
        });

        // 點擊 input 時就顯示熱門城市
        destinationInput.addEventListener("focus", () => {
            showSuggestions(); // 無輸入時預設顯示所有熱門城市
        });

        // 點選建議
        suggestionsEl.addEventListener("click", (e) => {
            if (e.target.tagName === "LI") {
                destinationInput.value = e.target.textContent;
                suggestionsEl.style.display = "none";
            }
        });

        // 點擊外部隱藏清單
        document.addEventListener("click", (e) => {
            if (!suggestionsEl.contains(e.target) && e.target !== destinationInput) {
                suggestionsEl.style.display = "none";
            }
        });

        // 選擇日期 -------------------------------------------------

        flatpickr("#daterange", {
            locale: "zh_tw",
            mode: "range",
            minDate: "today",
            dateFormat: "Y-m-d",
            showMonths: 2
        });

        // 選擇數量 -------------------------------------------------
        // 房客 popup 與數量控制
        const guestBtn = document.getElementById("guest-btn");
        const guestPopup = document.getElementById("guest-popup");

        const guestCounts = {
            adults: 2,
            children: 0,
            rooms: 1
        };

        // 更新顯示文字
        function updateGuestText() {
            guestBtn.value = `${guestCounts.adults} 位成人・${guestCounts.children} 位孩童・${guestCounts.rooms} 間房`;
        }

        // 顯示/隱藏 popup
        guestBtn.addEventListener("click", (e) => {
            e.stopPropagation();
            if (guestPopup.style.display === "block") {
                guestPopup.style.display = "none";
            } else {
                guestPopup.style.display = "block";
            }
        });

        // 點擊外部關閉 popup
        document.addEventListener("click", (e) => {
            if (!guestPopup.contains(e.target) && e.target !== guestBtn) {
                guestPopup.style.display = "none";
            }
        });

        // 控制加減按鈕
        guestPopup.querySelectorAll("button.qty-btn").forEach(btn => {
            btn.addEventListener("click", () => {
                const type = btn.dataset.type;
                const action = btn.dataset.action;

                if (action === "increase") {
                    guestCounts[type]++;
                } else if (action === "decrease") {
                    if ((type === "adults" || type === "rooms") && guestCounts[type] > 1) {
                        guestCounts[type]--;
                    } else if (type === "children" && guestCounts[type] > 0) {
                        guestCounts[type]--;
                    }
                }

                // 更新 popup 顯示數字
                document.getElementById(type + "-count").textContent = guestCounts[type];
                // 更新輸入欄文字
                updateGuestText();
            });
        });

        // 初始化文字顯示
        updateGuestText();
    </script>


</body>

</html>