<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modal Demo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- 加在 <head> 裡 -->
  <link href="https://cdn.jsdelivr.net/npm/nouislider@15.7.1/dist/nouislider.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/nouislider@15.7.1/dist/nouislider.min.js"></script>
  <style>
    body {
      background: #f7f8fa;
    }

    .modal-content.filter-modal-content {
      border-radius: 22px !important;
      background: #fff;
      box-shadow: 0 8px 40px 0 rgba(55, 105, 150, .13) !important;
      display: flex;
      flex-direction: column;
      max-height: 98vh;
      height: auto;
      padding: 0;
      overflow: hidden;
    }

    .filter-modal-body {
      flex: 1 1 auto;
      overflow-y: auto;
      padding: 30px 36px 0 36px;
      min-height: 0;
    }

    .filter-modal-footer {
      background: #fff;
      border-top: 1.5px solid #e4e6eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 20px;
      padding: 18px 36px 28px 36px;
      flex-shrink: 0;
    }

    .modal-title {
      color: #376996;
      font-size: 1.5rem;
      font-weight: 700;
    }

    .modal-header .btn-close {
      position: absolute;
      right: 32px;
      top: 50%;
      transform: translateY(-50%);
    }

    .modal-header {
      position: relative;
    }

    .btn-apply,
    .btn-clear {
      padding: 15px 28px;
      font-size: 1.08rem;
      border-radius: 14px;
      border: none;
      font-weight: 600;
      min-width: 120px;
      transition: background 0.16s, color 0.16s;
    }

    .btn-apply {
      background: #376996;
      color: #fff;
    }

    .btn-apply:hover {
      background: #2056b2;
      color: #fff;
    }

    .btn-clear {
      background: transparent;
      color: #376996;
      border: 1.5px solid #376996;
    }

    .btn-clear:hover {
      background: #2056b2;
      color: #FFFFFF;
      border: 1.5px solid #376996;
    }

    .modal-section .section-title {
      color: #376996;
      font-weight: 700;
      margin-bottom: 10px;
      font-size: 1rem;
    }

    .modal-divider {
      border: none;
      border-top: 1px solid #e4e6eb;
      margin: 24px 0 20px 0;
    }

    .recommend-btn {
      border-radius: 12px;
      border: 1.5px solid #e4e6eb;
      background: #fff;
      color: #376996;
      font-size: 1rem;
      font-weight: 500;
      padding: 70px 60px;
      justify-content: center;
      margin: 0 8px 10px 0;
      transition: all 0.18s;
    }

    .recommend-options,
    .facility-options {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 24px;
      flex-wrap: wrap;
      margin-bottom: 24px;
    }

    .facility-btn {
      border-radius: 12px;
      border: 1.5px solid #e4e6eb;
      background: #fff;
      color: #376996;
      font-size: 1rem;
      font-weight: 500;
      padding: 10px 20px;
      margin: 0 8px 10px 0;
      transition: all 0.18s;
    }

    .recommend-btn.active,
    .recommend-btn:hover,
    .facility-btn.active,
    .facility-btn:active,
    .facility-btn:hover {
      color: #376996;
      border-color: #376996;
    }

    .price-slider-wrap {
      margin-bottom: 8px;
      padding: 0 14px 0 8px;
    }

    .price-range {
      margin-top: 8px;
      font-size: 1.07rem;
      color: #376996;
      font-weight: 600;
      letter-spacing: 1px;
    }

    .recommend-btn.active,
    .facility-btn.active {
      color: #376996;
      border: 2.5px solid #376996;
    }

    @media (max-width: 768px) {
      .modal-content.filter-modal-content {
        height: 95vh;
        min-height: 0;
        border-radius: 14px !important;
      }

      .filter-modal-body,
      .filter-modal-footer {
        padding-left: 12px;
        padding-right: 12px;
      }

      .filter-modal-footer {
        flex-direction: column;
        align-items: stretch;
        gap: 12px;
      }

      .btn-apply,
      .btn-clear {
        width: 100%;
        margin-bottom: 0;
      }
    }
  </style>
</head>

<body>
  <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#filterModal">打開篩選 Modal</button>
  <div class="modal fade" id="filterModal" tabindex="-1" aria-labelledby="filterModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content filter-modal-content">
        <div class="modal-header border-0 justify-content-center">
          <h2 class="modal-title" id="filterModalLabel">篩選條件</h2>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="關閉"></button>
        </div>
        <div class="modal-body filter-modal-body">
          <div class="modal-section recommend-section">
            <div class="section-title">為你推薦</div>
            <div class="recommend-options">
              <button class="recommend-btn" data-recommend="rating">最高評價</button>
              <button class="recommend-btn" data-recommend="price">最低價格</button>
              <button class="recommend-btn" data-recommend="facility">熱門設施</button>
            </div>
          </div>
          <hr class="modal-divider">
          <div class="modal-section price-section">
            <div class="section-title">價格範圍</div>
            <div class="price-slider-wrap">
              <div id="priceSlider"></div>
              <div class="price-range">
                <span id="minPrice">500</span> - <span id="maxPrice">3000</span>
              </div>
            </div>
          </div>
          <hr class="modal-divider">
          <div class="modal-section facility-section">
            <div class="section-title">設施</div>
            <div class="facility-options">
              <button type="button" class="facility-btn">免費wifi</button>
              <button type="button" class="facility-btn">停車場</button>
              <button type="button" class="facility-btn">溫泉</button>
              <button type="button" class="facility-btn">餐廳</button>
              <button type="button" class="facility-btn">健身房</button>
              <button type="button" class="facility-btn">自助洗衣</button>
              <button type="button" class="facility-btn">寵物友善</button>
              <button type="button" class="facility-btn">自行車友善</button>
              <button type="button" class="facility-btn">會議室</button>
              <button type="button" class="facility-btn">酒吧</button>
              <button type="button" class="facility-btn">商店</button>
              <button type="button" class="facility-btn">接送服務</button>
              <button type="button" class="facility-btn">無障礙設施</button>
            </div>
          </div>
        </div>
        <div class="modal-footer filter-modal-footer border-0">
          <button class="btn btn-clear" id="clearAllBtn" type="button">清除全部</button>
          <button class="btn btn-apply" type="button" onclick="applyFilter()">顯示 1000+ 住宿</button>
        </div>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // 假設你後端回來有 count 筆住宿，前端動態改文字
    function updateHotelCount(count) {
      document.querySelector('.btn-apply').textContent = `顯示 ${count}+ 住宿`;
    }
    // 測試動態顯示：
    // setTimeout(() => {
    //   updateHotelCount(1000);
    // }, 3000);
    // 初始化價格滑桿
    const priceSlider = document.getElementById('priceSlider');
    const minPriceEl = document.getElementById('minPrice');
    const maxPriceEl = document.getElementById('maxPrice');

    noUiSlider.create(priceSlider, {
      start: [1000, 80000],
      connect: true,
      range: {
        'min': 500,
        'max': 100000
      },
      step: 100,
      format: {
        to: value => Math.round(value),
        from: value => Number(value)
      }
    });

    // 滑動時更新文字
    priceSlider.noUiSlider.on('update', function (values) {
      minPriceEl.textContent = values[0];
      maxPriceEl.textContent = values[1];
    });

    const recommendBtns = document.querySelectorAll('.recommend-btn');
    const facilityBtns = document.querySelectorAll('.facility-btn');
    const clearBtn = document.getElementById('clearAllBtn');
    const applyBtn = document.querySelector('.btn-apply');

    // 模擬住宿數量計算
    function updateCountText() {
      const selectedRecommends = document.querySelectorAll('.recommend-btn.active').length;
      const selectedFacilities = document.querySelectorAll('.facility-btn.active').length;

      const priceRange = priceSlider.noUiSlider.get(); // [min, max]
      const defaultMin = 500;
      const defaultMax = 3000;
      const currentMin = parseInt(priceRange[0]);
      const currentMax = parseInt(priceRange[1]);
      const isPriceChanged = currentMin !== defaultMin || currentMax !== defaultMax;

      const totalSelected = selectedRecommends + selectedFacilities + (isPriceChanged ? 1 : 0);

      if (totalSelected > 0) {
        applyBtn.textContent = `顯示 ${1000 + totalSelected}+ 住宿`;
      } else {
        applyBtn.textContent = `顯示 1000+ 住宿`;
      }
    }

    // 切換 active 狀態並更新數量
    function toggleButton(buttons) {
      buttons.forEach(btn => {
        btn.addEventListener('click', () => {
          btn.classList.toggle('active');
          updateCountText();
        });
      });
    }

    // 綁定切換功能
    toggleButton(recommendBtns);
    toggleButton(facilityBtns);

    // 滑桿改動時更新
    priceSlider.noUiSlider.on('change', updateCountText);

    // 清除全部
    clearBtn.addEventListener('click', () => {
      recommendBtns.forEach(btn => btn.classList.remove('active'));
      facilityBtns.forEach(btn => btn.classList.remove('active'));
      priceSlider.noUiSlider.set([1000, 80000]);
      updateCountText();
    });

    // 預設顯示一次
    updateCountText();
  </script>
</body>

</html>